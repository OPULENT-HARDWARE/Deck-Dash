<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deck News (Merged RSS)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #050608;
      --card-bg: rgba(255,255,255,0.04);
      --card-bg-hover: rgba(255,255,255,0.07);
      --muted: rgba(255,255,255,0.65);
      --accent: #6fff86;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .shell {
      box-sizing: border-box;
      padding: 14px 18px;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
      opacity: 0.9;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(135,255,171,0.7);
    }

    .header-main {
      font-size: 11px;
      font-weight: 500;
      color: #fff;
    }

    .header-meta {
      font-size: 10px;
      color: var(--muted);
      text-align: right;
    }

    .news-list {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-right: 4px;
    }

    .message {
      font-size: 13px;
      color: var(--muted);
    }

    .card {
      border-radius: 12px;
      padding: 10px 12px;
      background: var(--card-bg);
      transition: background 0.15s ease, transform 0.08s ease;
      cursor: pointer;
    }

    .card:hover {
      background: var(--card-bg-hover);
      transform: translateY(-1px);
    }

    .title {
      font-size: 13px;
      margin: 0 0 5px;
      line-height: 1.3;
    }

    .title a {
      color: #fff;
      text-decoration: none;
    }

    .title a:hover {
      text-decoration: underline;
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .desc {
      font-size: 12px;
      color: rgba(255,255,255,0.8);
      line-height: 1.4;
    }

    @media (max-width: 480px) {
      .shell {
        padding: 10px 10px 8px;
      }
      .desc {
        display: none; /* tighter on tiny spaces */
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="header">
      <div class="header-left">
        <div class="dot"></div>
        <div class="header-main" id="heading-label">
          Global Headlines • Merged
        </div>
      </div>
      <div class="header-meta" id="heading-meta">
        Loading…
      </div>
    </div>

    <div id="news-list" class="news-list">
      <div class="message">Loading merged headlines…</div>
    </div>
  </div>

  <script>
    /**
     * Three proven-current RSS feeds:
     *  - BBC World
     *  - NPR News
     *  - TechCrunch
     * Fetched via rss2json (no API key), merged & sorted by date.
     */
    const FEEDS = [
      {
        id: "bbc",
        label: "BBC World",
        rss: "https://feeds.bbci.co.uk/news/world/rss.xml"
      },
      {
        id: "npr",
        label: "NPR News",
        rss: "https://feeds.npr.org/1001/rss.xml"
      },
      {
        id: "tc",
        label: "TechCrunch",
        rss: "https://techcrunch.com/feed/"
      }
    ];

    // Public RSS -> JSON converter; no key required
    const toApiUrl = (rssUrl) =>
      "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(rssUrl);

    const headingLabel = document.getElementById("heading-label");
    const headingMeta  = document.getElementById("heading-meta");
    const newsList     = document.getElementById("news-list");

    function formatTime(dateStr) {
      const d = new Date(dateStr);
      if (isNaN(d)) return "";
      const diffSec = (Date.now() - d.getTime()) / 1000;

      if (diffSec < 60)            return "just now";
      if (diffSec < 3600)          return Math.floor(diffSec / 60) + " min ago";
      if (diffSec < 86400)         return Math.floor(diffSec / 3600) + " h ago";
      if (diffSec < 86400 * 7)     return Math.floor(diffSec / 86400) + " d ago";

      return d.toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    async function loadFeeds() {
      newsList.innerHTML = '<div class="message">Loading merged headlines…</div>';
      headingMeta.textContent = "Fetching…";

      const results = await Promise.allSettled(
        FEEDS.map(feed =>
          fetch(toApiUrl(feed.rss))
            .then(res => {
              if (!res.ok) throw new Error("HTTP " + res.status);
              return res.json();
            })
            .then(json => ({ feed, json }))
        )
      );

      const allItems = [];
      let successCount = 0;

      results.forEach(result => {
        if (result.status === "fulfilled") {
          successCount++;
          const { feed, json } = result.value;
          const items = json.items || [];

          items.forEach(item => {
            allItems.push({
              sourceId: feed.id,
              sourceLabel: feed.label,
              title: item.title || "Untitled",
              link: item.link || "#",
              description: item.description || "",
              pubDate: item.pubDate || item.isoDate || item.pubdate || ""
            });
          });
        } else {
          console.warn("Feed failed:", result.reason);
        }
      });

      if (!allItems.length) {
        newsList.innerHTML = `
          <div class="message">
            Failed to load all news feeds.<br>
            RSS sources or proxy might be blocked.
          </div>
        `;
        headingMeta.textContent = "Error";
        return;
      }

      // Sort newest → oldest
      allItems.sort((a, b) => {
        const ta = new Date(a.pubDate).getTime() || 0;
        const tb = new Date(b.pubDate).getTime() || 0;
        return tb - ta;
      });

      headingMeta.textContent =
        `Updated • ${allItems.length} stories • ${successCount}/${FEEDS.length} feeds`;

      newsList.innerHTML = "";

      allItems.slice(0, 40).forEach(item => {
        const div = document.createElement("div");
        div.className = "card";

        const timeLabel = item.pubDate ? formatTime(item.pubDate) : "";
        const title = item.title;
        const link  = item.link;
        const desc  = item.description;

        div.innerHTML = `
          <div class="title">
            <a href="${link}" target="_blank" rel="noopener noreferrer">
              ${title}
            </a>
          </div>
          <div class="meta-row">
            <span>${item.sourceLabel}</span>
            ${timeLabel ? `<span>${timeLabel}</span>` : ""}
            <span class="pill">RSS</span>
          </div>
          ${desc ? `<div class="desc">${desc}</div>` : ""}
        `;

        div.addEventListener("click", () => {
          if (link && link !== "#") {
            window.open(link, "_blank", "noopener");
          }
        });

        newsList.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", loadFeeds);
  </script>
</body>
</html>
